define(["jquery","jshashtable"],function(t){"use strict";function r(){function r(r,i,n,c){l=t.extend(!0,{},l,r),null===l.prefix&&(l.prefix=l.placeholder),_=c,l.rows_content=o(n),e(l.placeholder,i,n),a(n),l.export_id=l.export_id||l.prefix+"_export",t("#"+l.export_id).on("click",function(){d(t("#"+l.prefix),l.title.toLocaleLowerCase()+" data.csv")})}function e(r,e){var a='<div style="overflow: auto; padding-top:10px; width:100%">';a+='<table class="dataTable">',a+="<thead>",a+="<tr>",l.add_first_column&&(a+="<th>"+l.header.column_0+"</th>"),a+="<th>"+l.header.column_1+"</th>",a+="<th>"+_.avg+" "+e[0]+"-"+e[e.length-1]+"</th>",e.forEach(function(t){a+="<th>"+t+"</th>"}),a+="</tr>",a+="</thead>",a+="<tbody>";for(var i=0,n=0;n<l.rows_content;n++){var o="hor-minimalist-b_row"+(n%2+1);a+="<tr>",l.add_first_column&&(a+="<td class='"+o+"' id='"+l.prefix+"_"+n+"_0'>-</td>"),a+="<td class='"+o+"' id='"+l.prefix+"_"+n+"_1'>-</td>",a+="<td class='"+o+"' id='"+l.prefix+"_avg_"+n+"'>-</td>",e.forEach(function(t){a+="<td class='"+o+"' id='"+l.prefix+"_"+n+"_"+t+"'>-</td>"}),a+="</tr>",i++}var o="hor-minimalist-b_row"+(i%2+1)+" hor-minimalist-b_row-bold";a+="<tr>",l.add_first_column&&(a+="<td class='"+o+"' id='"+l.prefix+"_total_0'>"+l.total.column_0+"</td>"),a+="<td class='"+o+"' id='"+l.prefix+"_total_1'>"+l.total.column_1+"</td>",a+="<td class='"+o+"' id='"+l.prefix+"_total_avg'>-</td>",e.forEach(function(t){a+="<td class='"+o+"' id='"+l.prefix+"_total_"+t+"'>-</td>"}),a+="</tr>",a+="</tbody>",a+="</table>",a+="</div>",t("#"+r).append(a)}function a(r){for(var e=0,a=0,o=0,d={},_=0,c=0,f=l.add_first_column?1:0,u=l.add_first_column?r[0][0]:null,s=r[0][f],h=0;h<r.length;h++){s!=r[h][f]&&(i(e,s,a,o,u),c+=a/o,s=r[h][f],u=l.add_first_column?r[h][f-1]:null,e++,o=0,a=0);var m=Number(parseFloat(r[h][f+2]).toFixed(l.decimal_values));t("#"+l.prefix+"_"+e+"_"+r[h][f+1]).html(m),a+=m,o+=1,_+=m,d[r[h][f+1]]=d[r[h][f+1]]?d[r[h][f+1]]+=m:m}var u=l.add_first_column?r[r.length-1][f-1]:null;i(e,s,a,o,u),c+=a/o,n(d,c)}function i(r,e,a,i,n){n&&t("#"+l.prefix+"_"+r+"_0").html(n),t("#"+l.prefix+"_"+r+"_1").html(e),t("#"+l.prefix+"_avg_"+r).html(Number(a/i).toFixed(l.decimal_values))}function n(r,e){for(var a in r)t("#"+l.prefix+"_total_"+a).html(Number(r[a]).toFixed(l.decimal_values));t("#"+l.prefix+"_total_avg").html(Number(e).toFixed(l.decimal_values))}function o(t){for(var r=l.add_first_column?1:0,e=t[0][r],a=0,i=0;i<t.length;i++)e!=t[i][r]&&(e=t[i][r],a++);return a++,a}function d(r,e){function a(t){return t.get().join(_).split(_).join(f).split(l).join(c)}function i(r,e){var a=t(e),i=a.find("td");return i.length||(i=a.find("th")),i.map(n).get().join(l)}function n(r,e){var a=t(e),i=a.text();return i.replace('"','""')}var o=r.find("tr:has(th)"),d=r.find("tr:has(td)"),l=String.fromCharCode(11),_=String.fromCharCode(0),c='","',f='"\r\n"',u='"';u+=a(o.map(i)),u+=f,u+=a(d.map(i))+'"';var s=document.createElement("a");s.href="data:text/csv;charset=utf-8,"+encodeURIComponent(u),s.target="_blank",s.download=e,document.body.appendChild(s),s.click()}var l={prefix:null,placeholder:"id",export_id:"",decimal_values:0,add_first_column:!0},_=null;return{init:r}}return r});
